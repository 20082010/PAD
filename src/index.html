
<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>PAD情感测量-小布康康</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Lucide icons -->
  <script src="https://unpkg.com/lucide@latest"></script>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; }
    .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
    .card-shadow { box-shadow: 0 4px 6px -1px rgba(0,0,0,.1), 0 2px 4px -2px rgba(0,0,0,.1); }
    .slider-thumb::-webkit-slider-thumb { @apply bg-blue-500 w-5 h-5 rounded-full cursor-pointer appearance-none; }
    .slider-thumb::-moz-range-thumb { @apply bg-blue-500 w-5 h-5 rounded-full cursor-pointer border-none; }
  </style>
</head>
<body class="bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 min-h-screen flex items-center justify-center p-2 sm:p-4">
  <div id="app" class="w-full max-w-md"></div>

  <!-- 单页面脚本 -->
  <script>
    /* ========= 常量定义 ========= */
    const EMOTIONS = [
      { name: '喜悦', P: 2.77, A: 1.21, D: 1.42 },
      { name: '乐观', P: 2.48, A: 1.05, D: 1.75 },
      { name: '轻松', P: 2.19, A: -0.66, D: 1.05 },
      { name: '惊奇', P: 1.72, A: 1.71, D: 0.22 },
      { name: '温和', P: 1.57, A: -0.79, D: 0.38 },
      { name: '依赖', P: 0.39, A: -0.81, D: 1.48 },
      { name: '无聊', P: -0.53, A: -1.25, D: -0.84 },
      { name: '悲伤', P: -0.89, A: 0.17, D: -0.70 },
      { name: '恐惧', P: -0.93, A: 1.30, D: -0.64 },
      { name: '焦虑', P: -0.95, A: 0.32, D: -0.63 },
      { name: '藐视', P: -1.58, A: 0.32, D: 1.02 },
      { name: '厌恶', P: -1.80, A: 0.40, D: 0.67 },
      { name: '愤', P: -1.98, A: 1.10, D: 0.60 },
      { name: '敌意', P: -2.08, A: 1.00, D: 1.12 }
    ];
    const QUESTIONS = [
      { left: '愤怒的', right: '有活力的', key: 'q1' },
      { left: '清醒的', right: '困倦的', key: 'q2' },
      { left: '被控的', right: '主控的', key: 'q3' },
      { left: '友好的', right: '轻蔑的', key: 'q4' },
      { left: '平静的', right: '激动的', key: 'q5' },
      { left: '支配的', right: '顺从的', key: 'q6' },
      { left: '残忍的', right: '高兴的', key: 'q7' },
      { left: '感兴趣的', right: '放松的', key: 'q8' },
      { left: '被引导的', right: '自主的', key: 'q9' },
      { left: '兴奋的', right: '激怒的', key: 'q10' },
      { left: '放松的', right: '充满希望的', key: 'q11' },
      { left: '有影响力的', right: '被影响的', key: 'q12' }
    ];

    /* ========= 状态管理 ========= */
    let state = {
      currentStep: 'info',
      userInfo: { name: '', phone: '', age: '', gender: 'male' },
      answers: {},
      currentQuestion: 0,
      result: null,
      history: JSON.parse(localStorage.getItem('pad_emotion_history') || '[]'),
      viewingHistory: null
    };

    /* ========= 工具函数 ========= */
    function $(sel) { return document.querySelector(sel); }
    function setState(newState) {
      state = { ...state, ...newState };
      render();
    }
    function saveHistory() {
      localStorage.setItem('pad_emotion_history', JSON.stringify(state.history));
    }

    /* ========= 业务逻辑 ========= */
    function validateUserInfo() {
      if (!state.userInfo.name.trim()) { alert('请输入姓名'); return false; }
      if (!/^1[3-9]\d{9}$/.test(state.userInfo.phone)) { alert('请输入正确的手机号'); return false; }
      if (!state.userInfo.age || state.userInfo.age < 1 || state.userInfo.age > 120) { alert('请输入正确的年龄'); return false; }
      return true;
    }
    function calculatePAD() {
      const q = state.answers;
      const P = ((q.q1 || 0) - (q.q4 || 0) + (q.q7 || 0) - (q.q10 || 0)) / 4;
      const A = (-(q.q2 || 0) + (q.q5 || 0) - (q.q8 || 0) + (q.q11 || 0)) / 4;
      const D = ((q.q3 || 0) - (q.q6 || 0) + (q.q9 || 0) - (q.q12 || 0)) / 4;
      return { P: Math.round(P * 100) / 100, A: Math.round(A * 100) / 100, D: Math.round(D * 100) / 100 };
    }
    function calculateDistance(pad) {
      let min = Infinity, emotion = null;
      EMOTIONS.forEach(e => {
        const d = Math.sqrt((pad.P - e.P) ** 2 + (pad.A - e.A) ** 2 + (pad.D - e.D) ** 2);
        if (d < min) { min = d; emotion = e; }
      });
      return { emotion, distance: Math.round(min * 100) / 100 };
    }
    function handleSubmit() {
      const pad = calculatePAD();
      const match = calculateDistance(pad);
      const result = { ...state.userInfo, answers: state.answers, pad, match, timestamp: new Date().toISOString() };
      const history = [result, ...state.history].slice(0, 50);
      setState({ result, history, currentStep: 'result' });
      saveHistory();
    }

    /* ========= 渲染函数 ========= */
    function render() {
      const app = $('#app');
      app.innerHTML = {
        info: renderInfo,
        questions: renderQuestion,
        result: renderResult,
        history: renderHistory
      }[state.currentStep]();
      lucide.createIcons();
      bindEvents();
    }

    function renderInfo() {
      return `
        <div class="card-shadow bg-white rounded-xl overflow-hidden">
          <div class="bg-gradient-to-r from-blue-500 to-purple-600 text-white p-4">
            <h2 class="text-xl font-bold">请填写您的基本信息开始测评</h2>
          </div>
          <div class="p-4 space-y-4">
            <div>
              <label class="block text-sm font-medium mb-1">姓名 *</label>
              <input type="text" id="name" value="${state.userInfo.name}" placeholder="请输入您的姓名" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            <div>
              <label class="block text-sm font-medium mb-1">手机号 *</label>
              <input type="tel" id="phone" value="${state.userInfo.phone}" placeholder="请输入手机号" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            <div>
              <label class="block text-sm font-medium mb-1">年龄 *</label>
              <input type="number" id="age" value="${state.userInfo.age}" placeholder="请输入年龄" min="1" max="120" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            <div>
              <label class="block text-sm font-medium mb-1">性别</label>
              <div class="flex space-x-4">
                <label class="flex items-center"><input type="radio" name="gender" value="male" ${state.userInfo.gender === 'male' ? 'checked' : ''} class="mr-1"> 男</label>
                <label class="flex items-center"><input type="radio" name="gender" value="female" ${state.userInfo.gender === 'female' ? 'checked' : ''} class="mr-1"> 女</label>
              </div>
            </div>
            <button id="startBtn" class="w-full bg-gradient-to-r from-blue-500 to-purple-600 text-white py-2 rounded-md hover:from-blue-600 hover:to-purple-700 transition">开始测评</button>
            ${state.history.length ? `<button id="historyBtn" class="w-full border border-gray-300 py-2 rounded-md mt-2 flex items-center justify-center hover:bg-gray-50 transition"><i data-lucide="history" class="w-4 h-4 mr-2"></i>查看历史记录 (${state.history.length})</button>` : ''}
          </div>
        </div>
      `;
    }

    function renderQuestion() {
      const q = QUESTIONS[state.currentQuestion];
      const val = state.answers[q.key] || 0;
      return `
        <div>
          <div class="flex justify-end mb-2">
            <button id="cancelBtn" class="text-gray-500 hover:text-red-500 text-sm flex items-center transition"><i data-lucide="x-circle" class="w-4 h-4 mr-1"></i>取消</button>
          </div>
          <div class="card-shadow bg-white rounded-xl overflow-hidden">
            <div class="bg-gradient-to-r from-green-500 to-blue-500 text-white p-4">
              <h2 class="text-xl font-bold">问题 ${state.currentQuestion + 1}/12</h2>
              <p class="text-sm opacity-90">请选择您当前的情感倾向</p>
            </div>
            <div class="p-4 space-y-4">
              <div class="grid grid-cols-2 gap-4 text-center font-medium">
                <div class="text-red-600 bg-red-50 p-3 rounded-lg">${q.left}</div>
                <div class="text-green-600 bg-green-50 p-3 rounded-lg">${q.right}</div>
              </div>
              <div class="text-center text-2xl font-bold text-gray-800">${val < 0 ? q.left : val > 0 ? q.right : '中立'}</div>
              <input type="range" id="slider" min="-4" max="4" step="0.1" value="${val}" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider-thumb">
              <div class="flex justify-between text-sm text-gray-500">
                <span>-4 (${q.left})</span><span>0 (中立)</span><span>4 (${q.right})</span>
              </div>
              <div class="text-center"><span class="bg-gray-100 px-3 py-1 rounded-full text-lg">评分: ${parseFloat(val).toFixed(1)}</span></div>
              <div class="flex justify-between pt-4">
                <button id="prevBtn" ${state.currentQuestion === 0 ? 'disabled' : ''} class="border border-gray-300 px-4 py-2 rounded-md flex items-center disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50 transition"><i data-lucide="chevron-left" class="w-4 h-4 mr-1"></i>上一题</button>
                ${state.currentQuestion === 11
                  ? '<button id="submitBtn" class="bg-gradient-to-r from-green-500 to-blue-500 text-white px-4 py-2 rounded-md hover:from-green-600 hover:to-blue-600 transition">提交结果</button>'
                  : '<button id="nextBtn" class="bg-gradient-to-r from-blue-500 to-purple-600 text-white px-4 py-2 rounded-md flex items-center hover:from-blue-600 hover:to-purple-700 transition">下一题<i data-lucide="chevron-right" class="w-4 h-4 ml-1"></i></button>'
                }
              </div>
            </div>
          </div>
        </div>
      `;
    }

    function renderResult() {
      if (!state.result) return '';
      const { name, age, gender, phone, pad, match, timestamp } = state.result;
      return `
        <div class="space-y-4">
          <div class="card-shadow bg-white rounded-xl p-4">
            <h3 class="font-bold mb-2 text-gray-700">用户信息</h3>
            <div class="grid grid-cols-2 gap-2 text-sm text-gray-600">
              <div>姓名：${name}</div><div>年龄：${age}岁</div>
              <div>性别：${gender === 'male' ? '男' : '女'}</div><div>手机：${phone}</div>
            </div>
            <div class="text-xs text-gray-500 mt-2 pt-2 border-t">测试时间：${new Date(timestamp).toLocaleString()}</div>
          </div>

          <div class="card-shadow bg-white rounded-xl p-4">
            <h3 class="font-bold mb-2 text-gray-700">PAD维度分析</h3>
            <div class="grid grid-cols-3 gap-2 text-center">
              <div class="bg-blue-50 rounded-lg p-3 border border-blue-200"><div class="text-xl font-bold text-blue-600">${pad.P.toFixed(1)}</div><div class="text-xs text-blue-800 font-medium">愉悦度(P)</div></div>
              <div class="bg-green-50 rounded-lg p-3 border border-green-200"><div class="text-xl font-bold text-green-600">${pad.A.toFixed(1)}</div><div class="text-xs text-green-800 font-medium">激活度(A)</div></div>
              <div class="bg-purple-50 rounded-lg p-3 border border-purple-200"><div class="text-xl font-bold text-purple-600">${pad.D.toFixed(1)}</div><div class="text-xs text-purple-800 font-medium">支配度(D)</div></div>
            </div>
          </div>

          <div class="card-shadow bg-white rounded-xl p-4 text-center">
            <h3 class="font-bold mb-2 text-gray-700">情感匹配结果</h3>
            <div class="text-2xl font-bold text-indigo-600">${match.emotion.name}</div>
            <div class="text-sm text-gray-600 mt-1">匹配度: ${(100 - match.distance * 10).toFixed(1)}%</div>
          </div>

          <div class="grid grid-cols-2 gap-2">
            <button id="resetBtn" class="border border-gray-300 py-2 rounded-md flex items-center justify-center hover:bg-gray-50 transition"><i data-lucide="rotate-ccw" class="w-4 h-4 mr-2"></i>重新测试</button>
            <button id="historyBtn2" class="border border-gray-300 py-2 rounded-md flex items-center justify-center hover:bg-gray-50 transition"><i data-lucide="history" class="w-4 h-4 mr-2"></i>查看历史</button>
          </div>
        </div>
      `;
    }

    function renderHistory() {
      return `
        <div class="card-shadow bg-white rounded-xl overflow-hidden">
          <div class="bg-gradient-to-r from-indigo-500 to-purple-500 text-white p-4">
            <h2 class="text-xl font-bold">历史记录</h2>
            <p class="text-sm opacity-90">您过往的测评记录</p>
          </div>
          <div class="p-4">
            <div class="text-sm text-gray-600 mb-3">共 ${state.history.length} 条记录</div>
            <div class="max-h-96 overflow-y-auto space-y-3">
              ${state.history.length
                ? state.history.map((item, i) => `
                  <div class="border border-gray-200 rounded-lg p-3 cursor-pointer hover:shadow-md transition" data-index="${i}">
                    <div class="flex justify-between items-start">
                      <div>
                        <div class="font-medium text-gray-800">${item.name}</div>
                        <div class="text-xs text-gray-500">${new Date(item.timestamp).toLocaleString()}</div>
                      </div>
                      <span class="bg-gradient-to-r from-purple-100 to-pink-100 text-xs px-2 py-1 rounded-full">${item.match.emotion.name}</span>
                    </div>
                    <div class="text-xs grid grid-cols-3 gap-1 mt-2 text-center">
                      <div class="bg-blue-50 rounded py-1"><span class="text-blue-600 font-medium">P</span> ${item.pad.P.toFixed(1)}</div>
                      <div class="bg-green-50 rounded py-1"><span class="text-green-600 font-medium">A</span> ${item.pad.A.toFixed(1)}</div>
                      <div class="bg-purple-50 rounded py-1"><span class="text-purple-600 font-medium">D</span> ${item.pad.D.toFixed(1)}</div>
                    </div>
                  </div>
                `).join('')
                : '<div class="text-center text-gray-400 py-8">暂无历史记录</div>'
              }
            </div>
            <button id="homeBtn" class="w-full mt-4 bg-gradient-to-r from-indigo-500 to-purple-500 text-white py-2 rounded-md hover:from-indigo-600 hover:to-purple-600 transition"><i data-lucide="home" class="w-4 h-4 mr-2 inline"></i>返回首页</button>
          </div>
        </div>
      `;
    }

    /* ========= 事件绑定 ========= */
    function bindEvents() {
      // 信息页
      $('#startBtn')?.addEventListener('click', () => {
        state.userInfo = {
          name: $('#name').value,
          phone: $('#phone').value,
          age: $('#age').value,
          gender: $('input[name="gender"]:checked').value
        };
        if (validateUserInfo()) setState({ currentStep: 'questions' });
      });
      $('#historyBtn')?.addEventListener('click', () => setState({ currentStep: 'history' }));

      // 问题页
      $('#slider')?.addEventListener('input', e => {
        const key = QUESTIONS[state.currentQuestion].key;
        setState({ answers: { ...state.answers, [key]: parseFloat(e.target.value) } });
      });
      $('#prevBtn')?.addEventListener('click', () => setState({ currentQuestion: state.currentQuestion - 1 }));
      $('#nextBtn')?.addEventListener('click', () => setState({ currentQuestion: state.currentQuestion + 1 }));
      $('#submitBtn')?.addEventListener('click', handleSubmit);
      $('#cancelBtn')?.addEventListener('click', () => {
        if (confirm('确定取消当前测评吗？已填写的答案将被清除。')) setState({ currentStep: 'info', answers: {}, currentQuestion: 0 });
      });

      // 结果页
      $('#resetBtn')?.addEventListener('click', () => setState({ currentStep: 'info', answers: {}, currentQuestion: 0, result: null }));
      $('#historyBtn2')?.addEventListener('click', () => setState({ currentStep: 'history' }));

      // 历史页
      $('#homeBtn')?.addEventListener('click', () => setState({ currentStep: 'info' }));
      document.querySelectorAll('[data-index]').forEach(el => {
        el.addEventListener('click', () => {
          const idx = parseInt(el.dataset.index);
          setState({ result: state.history[idx], currentStep: 'result', viewingHistory: state.history[idx] });
        });
      });
    }

    /* ========= 初始化 ========= */
    render();
  </script>
</body>
</html>
